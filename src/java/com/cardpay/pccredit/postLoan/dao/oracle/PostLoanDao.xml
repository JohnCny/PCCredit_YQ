<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cardpay.pccredit.postLoan.dao.PostLoanDao">
	<resultMap id="refusemibusidata" type="com.cardpay.pccredit.postLoan.model.RefuseMibusidata" >
 	      <result column="ywbh"        property="ywbh"    jdbcType="VARCHAR" /> 
   		<result column="CHINESE_NAME"        property="CHINESE_NAME"    jdbcType="VARCHAR" />  
   		<result column="CARD_ID"        property="CARD_ID"    jdbcType="VARCHAR" /> 
   		<result column="TELEPHONE"        property="TELEPHONE"    jdbcType="VARCHAR" /> 
   		<result column="industry"        property="industry"    jdbcType="VARCHAR" />
   		<result column="spmc"        property="spmc"    jdbcType="VARCHAR" /> 
   		<result column="RESIDENTIAL_ADDRESS"        property="RESIDENTIAL_ADDRESS"    jdbcType="VARCHAR" /> 
   		<result column="JKJE"        property="JKJE"    jdbcType="VARCHAR" /> 
   		<result column="JKRQ"        property="JKRQ"    jdbcType="VARCHAR" /> 
   		<result column="AUDIT_TIME"        property="AUDIT_TIME"    jdbcType="VARCHAR" /> 
   		<result column="REFUSAL_REASON"        property="REFUSAL_REASON"    jdbcType="VARCHAR" /> 
   		<result column="DISPLAY_NAME"        property="DISPLAY_NAME"    jdbcType="VARCHAR" /> 
   		<result column="PROCESS_OP_STATUS"        property="PROCESS_OP_STATUS"    jdbcType="VARCHAR" /> 
 	 </resultMap>
 	 
 	  <resultMap id="CreditProcess" type="com.cardpay.pccredit.postLoan.model.CreditProcess" >
   		<result column="spmc" 		property="spmc"  />
		<result column="chinese_name" 	property="customername" />
		<result column="teamname" 	property="teamname" />
		<result column="bljg" 		property="bljg" />
		<result column="dklx" 		property="dklx" />
		<result column="assure_means"	property="mainassure"/>
		<result column="hyfl" 	property="industry" />
		<result column="display_name" 	property="mananger"/>
		<result column="created_time" property="applytime"/>
		<result column="apply_quota" 	property="applymoney"/>
		<result column="start_examine_time" 		property="willtime" />
		<result column="examine_result" 	property="auditopinion" />
		<result column="examine_amount" 	property="examineamount" />
		<result column="jkrq" 	property="audittime" />
		<result column="zjts" 	property="zjdays" />
		<result column="examine_lv"	    property="examine" 	 />
		<result column="status" 		property="status" />
		<result column="id" 		property="id" />
		<result column="CARD_ID" 		property="cardId" />
		<result column="carId" 		property="zjmh" />
		
		<result column="USER_ID_4" 		property="userid4" />
		<result column="START_EXAMINE_TIME" 		property="startexaminetime" />
		<result column="cssptime" 		property="cssptime" />
		<result column="DBFS" 		property="dbfs" />
		<result column="EXAMINE_RESULT" 		property="examineresult" />
		<result column="user_id_1" 		property="userid1" />
		<result column="user_id_2" 		property="userid2" />
		<result column="user_id_3" 		property="userid3" />
		<result column="qx" 		property="qx" />
		<result column="examine_lv" 		property="examinelv" />
		<result column="sptime" 		property="sptime" />
		<result column="sdjytime" 		property="sdjytime" />
		<result column="spje" 		property="spje" />
		<result column="splv" 		property="splv" />
		<result column="spqx" 		property="spqx" />
		<result column="beizhu" 		property="beizhu" />
		<result column="jlyy" 		property="jlyy" />
		<result column="zsw" 		property="zsw" />
		<result column="sdwuser1" 		property="sdwuser1" />
		<result column="sdtime" 		property="sdtime" />
		<result column="sdqx" 		property="sdqx" />
		<result column="sdje" 		property="sdje" />
		<result column="lv" 		property="lv" />
		<result column="jjyy" 		property="jjyy" />
		<result column="sdwuser1yj" 		property="sdwuser1yj" />
 	 </resultMap>
 	 
 	
	
	 <resultMap id="MibusidateView" type="com.cardpay.pccredit.postLoan.model.MibusidateView" >
	<result column="YWBH" property="YWBH" jdbcType="VARCHAR" />
	<result column="id" property="id" jdbcType="VARCHAR" />
	<result column="KHH" property="KHH" jdbcType="VARCHAR" />
	<result column="KHMC" property="KHMC" jdbcType="VARCHAR" />
	<result column="ZJHM" property="ZJHM" jdbcType="VARCHAR" />
	<result column="SSBM" property="SSBM" jdbcType="VARCHAR" />
	<result column="SJ" property="SJ" jdbcType="VARCHAR" />
	<result column="SXED" property="SXED" jdbcType="VARCHAR" />
	<result column="GHJL" property="GHJL" jdbcType="VARCHAR" />
	<result column="LOANDATE" property="LOANDATE" jdbcType="VARCHAR" />
	<result column="DQRQ" property="DQRQ" jdbcType="VARCHAR" />
	<result column="DKQX" property="DKQX" jdbcType="VARCHAR" />
	<result column="JZLL" property="JZLL" jdbcType="VARCHAR" />
	<result column="REQLMT" property="REQLMT" jdbcType="VARCHAR" />
	<result column="DELAYINTERESTDAYS" property="DELAYINTERESTDAYS" jdbcType="VARCHAR" />
	<result column="DELAYAMTDAYS" property="DELAYAMTDAYS" jdbcType="VARCHAR" />
	<result column="qs" property="qs" jdbcType="VARCHAR" />
	<result column="DLAYDT" property="DLAYDT" jdbcType="VARCHAR" />
	<result column="DF" property="DF" jdbcType="VARCHAR" />
	<result column="YE" property="YE" jdbcType="VARCHAR" />
	<result column="SHBJ" property="SHBJ" jdbcType="VARCHAR" />
	<result column="JKJE" property="JKJE" jdbcType="VARCHAR" />
	<result column="KSQXRQ" property="KSQXRQ" jdbcType="VARCHAR" />
	<result column="SHLX" property="SHLX" jdbcType="VARCHAR" />
	<result column="DKYE" property="DKYE" jdbcType="VARCHAR" />
	<result column="BNQX" property="BNQX" jdbcType="VARCHAR" />
	<result column="BWQX" property="BWQX" jdbcType="VARCHAR" />
	<result column="BALAMT" property="BALAMT" jdbcType="VARCHAR" />
	<result column="yxye" property="yxye" jdbcType="VARCHAR" /> 
	<result column="HKFS" property="HKFS" jdbcType="VARCHAR" />  
	<result column="je" property="je" jdbcType="VARCHAR" />  
	<result column="CREATE_TIME" property="CREATE_TIME" jdbcType="VARCHAR" /> 
	<result column="dlayamtsum" property="dlayamtsum" jdbcType="VARCHAR" /> 
 	 </resultMap>
	 <resultMap id="lszform" type="com.cardpay.pccredit.postLoan.model.TyRarepaylistForm" >
 	      	<result column="ywbh" 		property="ywbh" 			jdbcType="VARCHAR" />
 	      	<result column="khmc" 		property="khmc" 			jdbcType="VARCHAR" />
 	      	<result column="jkrq" 		property="jkrq" 			jdbcType="VARCHAR" />
 	      	<result column="bj" 		property="bj" 			jdbcType="VARCHAR" />
 	      	<result column="lx" 		property="lx" 			jdbcType="VARCHAR" />
 	      	<result column="jxfs" 		property="jxfs" 			jdbcType="VARCHAR" />
 	      	<result column="jzrq" 		property="jzrq" 			jdbcType="VARCHAR" />
 	      	<result column="display_name" 		property="display_name" 			jdbcType="VARCHAR" />
 	      	<result column="create_time" 		property="create_time" 			jdbcType="VARCHAR" />
 	 </resultMap>
	  <resultMap id="BaseResultMap" type="com.cardpay.pccredit.customer.model.TyRepayTkmxForm" >
   		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
 	  </resultMap>
	 <resultMap id="BaseResultMap1" type="com.cardpay.pccredit.postLoan.model.Fcloaninfo" >
   			  <result column="KEYCODE" 		property="keycode" jdbcType="VARCHAR" /> 
			  <result column="YEAR" 		property="year" jdbcType="VARCHAR" /> 
			  <result column="TIMES"		property="times" jdbcType="VARCHAR" /> 
			  <result column="BUSICODE" 	property="busicode" jdbcType="VARCHAR" /> 
			  <result column="BUSITYPE" 	property="busitype" jdbcType="VARCHAR" /> 
			  <result column="DEPTCODE" 	property="deptcode" jdbcType="VARCHAR" /> 
			  <result column="INSTCITYCODE" property="instcitycode" jdbcType="VARCHAR" /> 
			  <result column="CONTRACTCODE" property="contractcode" jdbcType="VARCHAR" /> 
			  <result column="CUSTID" 		property="custid" jdbcType="VARCHAR" /> 
			  <result column="CNAME" 		property="cname" jdbcType="VARCHAR" /> 
			  <result column="TYPEID" 		property="typeid" jdbcType="VARCHAR" /> 
			  <result column="CUSTTYPE" 	property="custtype" jdbcType="VARCHAR" /> 
			  <result column="CUSTPROPERTY" property="custproperty" jdbcType="VARCHAR" /> 
			  <result column="ORGCERTCODE" 	property="orgcertcode" jdbcType="VARCHAR" /> 
			  <result column="UNITCUSTTYPE" property="unitcusttype" jdbcType="VARCHAR" /> 
			  <result column="CARDTYPE" 	property="cardtype" jdbcType="VARCHAR" /> 
			  <result column="CARDNUM" 		property="cardnum" jdbcType="VARCHAR" /> 
			  <result column="CITY" 		property="city" jdbcType="VARCHAR" /> 
			  <result column="DISTRICTCOUNTY" property="districtcounty" jdbcType="VARCHAR" /> 
			  <result column="TOWN"			  property="town" jdbcType="VARCHAR" /> 
			  <result column="COMMUNITY" 	  property="community" jdbcType="VARCHAR" /> 
			  <result column="INSTCODE" 	  property="instcode" jdbcType="VARCHAR" /> 
			  <result column="CURRENCY" 	  property="currency" jdbcType="VARCHAR" /> 
			  <result column="MONEY" 		  property="money" jdbcType="VARCHAR" /> 
			  <result column="BALAMT" 		  property="balamt" jdbcType="VARCHAR" /> 
			  <result column="DEBTINTEREST"   property="debtinterest" jdbcType="VARCHAR" /> 
			  <result column="REQLMT" 		  property="reqlmt" jdbcType="VARCHAR" /> 
			  <result column="LOANDATE" 	  property="loandate" jdbcType="VARCHAR" /> 
			  <result column="ENDDATE" 		  property="enddate" jdbcType="VARCHAR" /> 
			  <result column="BUSISTATE"      property="busistate" jdbcType="VARCHAR" /> 
			  <result column="CREDITLEVEL"    property="creditlevel" jdbcType="VARCHAR" /> 
			  <result column="INDUSTRY"       property="industry" jdbcType="VARCHAR" /> 
			  <result column="LOANPURPOSE"    property="loanpurpose" jdbcType="VARCHAR" /> 
			  <result column="MAINASSURE"     property="mainassure" jdbcType="VARCHAR" /> 
			  <result column="BUSIMANAGER"    property="busimanager" jdbcType="VARCHAR" /> 
			  <result column="ISBACK" 		  property="isback" jdbcType="VARCHAR" /> 
			  <result column="ISBIGCOMPANY"   property="isbigcompany" jdbcType="VARCHAR" /> 
			  <result column="STATE" 		  property="state" jdbcType="VARCHAR" /> 
			  <result column="ISLOWRISK" 	  property="islowrisk" jdbcType="VARCHAR" /> 
			  <result column="VALIDTIME" 	  property="validtime" jdbcType="VARCHAR" /> 
			  <result column="SORTRESULT"     property="sortresult" jdbcType="VARCHAR" /> 
			  <result column="SORTRESULTFIVE" property="sortresultfive" jdbcType="VARCHAR" /> 
			  <result column="PRESORTRESULT"  property="presortresult" jdbcType="VARCHAR" /> 
			  <result column="PRESORTFIVE"    property="presortfive" jdbcType="VARCHAR" /> 
			  <result column="AUTOSORTRESULT" property="autosortresult" jdbcType="VARCHAR" /> 
			  <result column="AUTOSORTREMARK" property="autosortremark" jdbcType="VARCHAR" /> 
			  <result column="AUTOSORTFIVE"   property="autosortfive" jdbcType="VARCHAR" /> 
			  <result column="ISADM" 		  property="isadm" jdbcType="VARCHAR" /> 
			  <result column="CUSTSCALE"      property="custscale" jdbcType="VARCHAR" /> 
			  <result column="OVERTIMES"      property="overtimes" jdbcType="VARCHAR" /> 
			  <result column="DELAYAMTDAYS"   property="delayamtdays" jdbcType="VARCHAR" /> 
			  <result column="DELAYINTERESTDAYS" property="delayinterestdays" jdbcType="VARCHAR" /> 
			  <result column="CHANGEFLAG" 		 property="changeflag" jdbcType="VARCHAR" /> 
			  <result column="CATEGORYTYPE" 	 property="categorytype" jdbcType="VARCHAR" /> 
			  <result column="OPERDATETIME"      property="operdatetime" jdbcType="VARCHAR" /> 
			  <result column="OPERATOR" 		 property="operator" jdbcType="VARCHAR" /> 
			  <result column="ISWORKMANU" 		 property="isworkmanu" jdbcType="VARCHAR" /> 
			  <result column="ADMDATE" 			 property="admdate" jdbcType="VARCHAR" /> 
			  <result column="AJUSTSTATE" 		 property="ajuststate" jdbcType="VARCHAR" /> 
			  <result column="ISTRANS" 			 property="istrans" jdbcType="VARCHAR" /> 
			  <result column="LASTYEARSORTRESULT" property="lastyearsortresult" jdbcType="VARCHAR" /> 
			  <result column="PROCESSID" 		  property="processid" jdbcType="VARCHAR" /> 
			  <result column="TOBADLOANREASON"    property="tobadloanreason" jdbcType="VARCHAR" /> 
			  <result column="BADLOANDATE" 		  property="badloandate" jdbcType="VARCHAR" /> 
			  <result column="CREATE_TIME" 		  property="create_time" jdbcType="VARCHAR" /> 
 	 </resultMap>
 	 
 	 <resultMap id="BaseResultMap2" type="com.cardpay.pccredit.postLoan.model.RarepaylistForm" >
   		<result column="KEYCODE" 		property="keycode" 			jdbcType="VARCHAR" />
		<result column="REPAYDATE" 		property="repaydate" 		jdbcType="VARCHAR" />
		<result column="BUSICODE" 		property="busicode" 		jdbcType="VARCHAR" />
		<result column="REPAYAMT" 		property="repayamt" 		jdbcType="VARCHAR" />
		<result column="RAPAYINTEREST"	property="rapayinterest" 	jdbcType="VARCHAR" />
		<result column="SQUAREMODEL" 	property="squaremodel" 		jdbcType="VARCHAR" />
		<result column="SQUAREOPER" 	property="squareoper" 		jdbcType="VARCHAR" />
		<result column="HANDLESCHEMAID" property="handleschemaid" 	jdbcType="VARCHAR" />
		<result column="HANDLETYPEID" 	property="handletypeid"     jdbcType="VARCHAR" />
		<result column="INSTCODE" 		property="instcode" 		jdbcType="VARCHAR" />
		<result column="DEPTCODE" 		property="deptcode" 		jdbcType="VARCHAR" />
		<result column="INSTCITYCODE" 	property="instcitycode" 	jdbcType="VARCHAR" />
		<result column="OPERDATETIME" 	property="operdatetime" 	jdbcType="VARCHAR" />
		<result column="OPERATOR_1" 	property="operator_1" 		jdbcType="VARCHAR" />
		<result column="LOANSTATUS"	    property="loanstatus" 		jdbcType="VARCHAR" />
		<result column="ISTRANS" 		property="istrans" 			jdbcType="VARCHAR" />
		<result column="CREATE_TIME" 	property="create_time" 		jdbcType="VARCHAR" />
		<result column="PARAM1" 	    property="param1" 			jdbcType="VARCHAR" />
 	 </resultMap>
 	 
 	 
 	 <resultMap id="BaseResultMap3" type="com.cardpay.pccredit.postLoan.model.MibusidataForm" >
   		 <result column="BUSICODE"        property="busicode"    jdbcType="VARCHAR" />         
		 <result column="CUSTID"        property="custid"    jdbcType="VARCHAR" />         
		 <result column="CNAME"        property="cname"    jdbcType="VARCHAR" />         
		 <result column="DEPTCODE"        property="deptcode"    jdbcType="VARCHAR" />         
		 <result column="MAINASSURE"        property="mainassure"    jdbcType="VARCHAR" />         
		 <result column="REQLMT"        property="reqlmt"    jdbcType="VARCHAR" />         
		 <result column="LOANDATE"        property="loandate"    jdbcType="VARCHAR" />         
		 <result column="STARTDATE"        property="startdate"    jdbcType="VARCHAR" />         
		 <result column="ORIENDDATE"        property="orienddate"    jdbcType="VARCHAR" />         
		 <result column="ENDDATE"        property="enddate"    jdbcType="VARCHAR" />         
		 <result column="MONEY"        property="money"    jdbcType="VARCHAR" />         
		 <result column="BALAMT"        property="balamt"    jdbcType="VARCHAR" />         
		 <result column="STATE"        property="accountstate"    jdbcType="VARCHAR" />         
		 <result column="CLOSEDATE"        property="closedate"    jdbcType="VARCHAR" />         
		 <result column="FIVECLASS"        property="fiveclass"    jdbcType="VARCHAR" />         
		 <result column="DELAYAMTDAYS"        property="delayamtdays"    jdbcType="VARCHAR" />         
		 <result column="DELAYINTERESTDAYS"        property="delayinterestdays"    jdbcType="VARCHAR" />         
		 <result column="FIRSTINTERESTDATE"        property="firstinterestdate"    jdbcType="VARCHAR" />         
		 <result column="DEBTINTEREST"        property="debtinterest"    jdbcType="VARCHAR" />         
		 <result column="DEBTINTERESTTIMES"        property="debtinteresttimes"    jdbcType="VARCHAR" />         
		 <result column="DLAYAMT"        property="dlayamt"    jdbcType="VARCHAR" />         
		 <result column="DLAYDT"        property="dlaydt"    jdbcType="VARCHAR" />         
		 <result column="PAYDEBT"        property="paydebt"    jdbcType="VARCHAR" />         
		 <result column="INDEBTAMT"        property="indebtamt"    jdbcType="VARCHAR" />         
		 <result column="OUTDEBTAMT"        property="outdebtamt"    jdbcType="VARCHAR" />         
		 <result column="BALAMT"        property="balamt"    jdbcType="VARCHAR" />         
		 <result column="CREATE_TIME"        property="create_time"    jdbcType="VARCHAR" />    
		 <result column="CUSTIDNO"        property="custidno"    jdbcType="VARCHAR" />  
		 <result column="LIMIT"        property="limit"    jdbcType="VARCHAR" />  
		 <result column="REPAYMETHOD"        property="repaymethod"    jdbcType="VARCHAR" />  
 	 </resultMap>
 	 
 	 
 	 <resultMap id="BaseResultMap4" type="com.cardpay.pccredit.manager.model.REIMBURSEMENT" >
   		 <result column="ID"        property="id"    jdbcType="VARCHAR" />         
		 <result column="CUSTOMER_ID"          property="customerId"    jdbcType="VARCHAR" /> 
		 <result column="CUSTOMER_NAME"          property="customerName"    jdbcType="VARCHAR" />  
		 <result column="CUSTOMER_MANAGER_ID"          property="customerManagerId"    jdbcType="VARCHAR" />  
		 <result column="CUSTOMER_MANAGER_NAME"          property="customerManagerName"    jdbcType="VARCHAR" />  
		 <result column="LOANDATE"          property="loandate"    jdbcType="VARCHAR" />  
		 <result column="MONEY"          property="money"    jdbcType="VARCHAR" />  
		 <result column="LV"          property="lv"    jdbcType="VARCHAR" />  
		 <result column="REPAY_TIME"          property="repayTime"    jdbcType="VARCHAR" />  
		 <result column="REPAY_BJ"          property="repayBj"    jdbcType="VARCHAR" />  
		 <result column="REPAY_LX"          property="repayLx"    jdbcType="VARCHAR" />  
		 <result column="REPAY_METHOD"          property="repayMethod"    jdbcType="VARCHAR" />  
		 <result column="REPAY_MZEE"          property="repayMzee"    jdbcType="VARCHAR" />  
		 <result column="BUSI_CODE"          property="busiCode"    jdbcType="VARCHAR" />  
 	 </resultMap>
	<resultMap type="com.cardpay.pccredit.postLoan.model.BadloansManagerForm"
		id="BadloansManager">
		<result property="id" column="ID" />
		<result property="chinese_name" column="chinese_name" />
		<result property="custidno" column="custidno" />
		<result property="accountstatus" column="accountstatus" />
		<result property="contractmoney" column="contractmoney" />
		<result property="grantamount" column="grantamount" />
		<result property="duedate" column="duedate" />
		<result property="debtinterest" column="debtinterest" />
		<result property="restoredamount" column="restoredamount" />
		<result property="description" column="description" />
		<result property="display_name" column="display_name" />
	</resultMap>
	<resultMap type="com.cardpay.pccredit.postLoan.model.BadLoansResultForm"
		id="BadloansResult">
		<result property="id" column="ID" />
		<result property="deal_result" column="deal_result" />
		<result property="deal_date" column="deal_date" />
		<result property="dealby" column="accountstatus" />
	</resultMap>

	  <!-- <resultMap id="BaseResultMap" type="com.cardpay.pccredit.customer.model.TyRepayTkmxForm" >
   		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
 	  </resultMap>
 	 
 	 <resultMap id="BaseResultMap1" type="com.cardpay.pccredit.customer.model.TyRepayLshForm" >
   		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
 	 </resultMap>
 	
 	
	 	<select id="findListByFilter" resultMap="BaseResultMap" 
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  select a.*,b.product_name as productName,c.zjhm from ty_repay_tkmx a left join ty_product_type b on a.cpmc=b.product_code
					  left join ty_customer_base c on c.khnm=a.khh 
					  WHERE 1=1 
					  <if test="zjhm != null and zjhm != '' ">
						AND c.zjhm=#{zjhm}
					 </if>
					  order by c.zjhm,a.khjl 
					
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
		</select>
		
	<select id="findListCountByFilter" resultType="int"
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*) from ty_repay_tkmx a left join ty_product_type b on a.cpmc=b.product_code
					  left join ty_customer_base c on c.khnm=a.khh 
					  WHERE 1=1 
					  <if test="zjhm != null and zjhm != '' ">
						AND c.zjhm=#{zjhm}
					 </if>
					  order by c.zjhm,a.khjl
	</select> 
	
	
	<select id="findLshListByFilter" resultMap="BaseResultMap1" 
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  select a.*,b.khjl as khjl1  from ty_repay_lsz a left join ty_repay_tkmx b on a.jjh=b.jjh  
					  WHERE 1=1 
					  <if test="jjh != null and jjh != '' ">
						AND a.jjh=#{jjh}
					 </if>
					  order by a.jjh,b.khjl 
					
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findLshListCountByFilter" resultType="int"
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*)  from ty_repay_lsz a left join ty_repay_tkmx b on a.jjh=b.jjh  
					  WHERE 1=1 
					  <if test="jjh != null and jjh != '' ">
						AND a.jjh=#{jjh}
					 </if>
	</select>  -->
	
	
	<select id="findJJJnListByFilter" resultMap="BaseResultMap" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
				select * from tkmxtylist where 1=1
                     <if test="userId != null and userId != '' and userId!='000001'">
						AND USERID=#{userId}
					   </if>
					   <if test="busiCode != null and busiCode != '' ">
						AND trim(ywbh)=#{busiCode}
					   </if>
					  <if test="cardNum != null and cardNum != '' ">
							AND trim(zjhm)=#{cardNum}
					  </if>
					    
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findJJJnListCountByFilter" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(distinct ywbh)    from tkmxtylist where 1=1
           
                   <if test="userId != null and userId != '' and userId!='000001'">
						AND USERID=#{userId}
					   </if>
					   <if test="busiCode != null and busiCode != '' ">
						AND trim(ywbh)=#{busiCode}
					   </if>
					  <if test="cardNum != null and cardNum != '' ">
							AND trim(zjhm)=#{cardNum}
					  </if>
	</select>
	
	<select id="findJJJnListByFilters" resultMap="BaseResultMap" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
			 select * from tkmxtylist where 1=1
                     <if test="userId != null and userId != '' and userId!='000001'">
						AND USERID=#{userId}
					   </if>
					   <if test="busiCode != null and busiCode != '' ">
						AND trim(ywbh)=#{busiCode}
					   </if>
					  <if test="cardNum != null and cardNum != '' ">
							AND trim(zjhm)=#{cardNum}
					  </if>
					  
	</select>
	
	<select id="findLshJnListByFilter" resultMap="lszform" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
			 select  * from LSHTYLIST where 1=1 
			               <if test="busiCode != null and busiCode != '' ">
								AND trim(ywbh)=#{busiCode}
						</if>
						<!--  <if test="busiCode != null and busiCode != '' ">
								AND trim(tkmx.ywbh)=#{busiCode}
						</if> -->
			                 order by jkrq
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="selectRarepaylistfoInfoByBusicode" resultMap="lszform" parameterType="com.cardpay.pccredit.postLoan.filter.FcloaninfoFilter">

	    		select * from LSHTYLIST where 1=1
               <if test="busiCode != null and busiCode != '' ">
					AND trim(ywbh)=#{busiCode}
			</if>
			<!--  <if test="busiCode != null and busiCode != '' ">
					AND trim(tkmx.ywbh)=#{busiCode}
			</if> -->
                 order by jkrq
					
	<!-- 	<if test="rapayinterest != null and rapayinterest != '' ">
		   				AND a.rapayinterest=#{rapayinterest}
		   				</if>
		<if test="repayamt != null and repayamt != '' ">
		   				AND a.repayamt=#{repayamt}
		   				</if> -->
	</select>
	
<select id="findLshJnListCountByFilter" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(ywbh)  from LSHTYLIST where 1=1
               <if test="busiCode != null and busiCode != '' ">
					AND trim(ywbh)=#{busiCode}
			</if>
			<!--  <if test="busiCode != null and busiCode != '' ">
					AND trim(tkmx.ywbh)=#{busiCode}
			</if> -->
                 
	  
	</select>
	
	<select id="findObjectsByBusicode" resultMap="BaseResultMap1">
	    select *  from t_fcloaninfo a where 1=1 and 
	    a.BUSICODE=#{busicode}
	    
	</select>
	
	
	
		<select id="findTzJnListByFilter" resultMap="MibusidateView" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
				select distinct tym.YWBH,tym.ID,tym.KHH,tym.KHMC,tym.ZJHM,tym.SSBM,tym.SJ,tym.SXED,tym.GHJL,tym.LOANDATE, tym.DQRQ,tym.DKQX,
tym.JZLL,tym.REQLMT,nvl(tym.DELAYINTERESTDAYS,0) as DELAYINTERESTDAYS ,  nvl(tym.DELAYAMTDAYS,0) as DELAYAMTDAYS,
        tym.DLAYDT,tym.SHBJ,tym.JKJE,DKYE as YE ,tym.BNQX,tym.BWQX,tym.PAYDEBT,sum(tym.DKYE+tym.BNQX+tym.BWQX) as dlayamtsum,tym.BALAMT ,tym.YXYE,tym.USERID as  userid,tym.DISPLAY_NAME as display_name
                 from ty_mibusidata tym  where 1=1
			           <if test="userId != null and userId != '' and userId !='000001'">
			             and tym.USERID  =#{userId}
				         </if>
				         <if test="busiCode != null and busiCode != '' ">
							AND trim(tym.YWBH)=#{busiCode}
						</if>
						<if test="customerName != null and customerName != '' ">
							AND tym.KHMC=#{customerName}
						</if>
						 group by tym.YWBH,tym.ID,tym.KHH,tym.KHMC,tym.ZJHM,tym.SSBM,tym.SJ,tym.SXED,tym.GHJL,tym.LOANDATE, tym.DQRQ,tym.DKQX,
tym.JZLL,tym.REQLMT,nvl(tym.DELAYINTERESTDAYS,0)  ,  nvl(tym.DELAYAMTDAYS,0),
        tym.DLAYDT,tym.SHBJ,tym.JKJE,tym.KSQXRQ,tym.PAYDEBT,DKYE ,tym.BNQX,tym.BWQX ,tym.BALAMT ,tym.YXYE,tym.USERID ,tym.DISPLAY_NAME
         order by tym.LOANDATE
					<!--   select
			        distinct
			          tkmx.YWBH ,
			          b.id as id ,
			          b.KHH,
			          b.KHMC,
			          b.ZJHM,
			          rygl.SSBM,
			          b.SJ,
			          b.SXED,
			          b.GHJL,
			          tkmx.JKRQ as LOANDATE, 
			          tkmx.DQRQ,
			          tkmx.DKQX,
			          tkmx.JZLL,
			          tkmx.FFJE   as REQLMT,
			           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end ) as DELAYINTERESTDAYS,  
			           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end )as DELAYAMTDAYS, 
			           max(lsz.jzrq) as DLAYDT,
			          yehz.SHBJ,
			          yehz.JKJE,
			          yehz.KSQXRQ,
			          yehz.SHLX as PAYDEBT,  
			          yehz.DKYE as YE ,
			          yehz.BNQX,
			          yehz.BWQX,
			          yehz.DKYE as BALAMT  ,
			          yehz.dkye as yxye,
			          sysuser.id userid,
			          sysuser.display_name
			       from
			              ty_repay_tkmx tkmx,
			              ty_customer_base b,
			              ty_customer_rygl rygl,
			              sys_user sysuser,
			              ty_kdk_jh jh,
			              ty_repay_yehz yehz,
			              ty_repay_lsz lsz
			              where b.khjl=rygl.dm and
			              rygl.ddrq=sysuser.external_id and
			              b.khnm=tkmx.khh and
			              jh.ywbh=tkmx.ywbh||'HT' and
			              yehz.jjh=tkmx.jjh and
			              tkmx.jjh =lsz.jjh
			            <if test="userId != null and userId != '' and userId !='000001'">
			             and sysuser.id  =#{userId}
				         </if>
				         <if test="busiCode != null and busiCode != '' ">
							AND trim(tkmx.ywbh)=#{busiCode}
						</if>
						<if test="customerName != null and customerName != '' ">
							AND b.khmc=#{customerName}
						</if>
			              group by tkmx.YWBH ,b.id ,b.KHH,b.KHMC, b.ZJHM,rygl.SSBM, b.SJ, b.SXED, b.GHJL,tkmx.JKRQ , tkmx.DQRQ, tkmx.DKQX,tkmx.JZLL, tkmx.FFJE  ,
			                 yehz.SHBJ,yehz.JKJE, yehz.KSQXRQ,yehz.SHLX, yehz.DKYE,yehz.BNQX, yehz.BWQX,yehz.DKYE  , yehz.dkye  , sysuser.display_name, sysuser.id  
			              order by tkmx.jkrq-->
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	
	<select id="findTzJnListCountByFilter" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(distinct  YWBH)  from ty_mibusidata where 1=1
	  	<if test="busiCode != null and busiCode != '' ">
			AND trim(BUSICODE)=#{busiCode}
		</if>
		
	  	<if test="customerName != null and customerName != '' ">
			AND cname =#{customerName}
		 </if>
	</select>
	
	
	
	
	<select id="findReimbListByFilter" resultMap="BaseResultMap4" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  select a.* from t_reimbursement a where 1=1 and has_tell !=1
					 <if test="customerName != null and customerName != '' ">
						AND CUSTOMER_NAME =#{customerName}
					 </if>
					 <if test="customerManagerName != null and customerManagerName != '' ">
						AND CUSTOMER_MANAGER_NAME =#{customerManagerName}
					 </if>
					 <if test="userId != null and userId != '' ">
						AND CUSTOMER_MANAGER_ID =#{userId}
					 </if>
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	
	<select id="findReimbCountListByFilter" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*)  from t_reimbursement where 1=1 and has_tell !=1
	  	<if test="customerName != null and customerName != '' ">
			AND CUSTOMER_NAME =#{customerName}
		 </if>
		 <if test="customerManagerName != null and customerManagerName != '' ">
			AND CUSTOMER_MANAGER_NAME =#{customerManagerName}
		 </if>
		 <if test="userId != null and userId != '' ">
			AND CUSTOMER_MANAGER_ID =#{userId}
		 </if>
	</select>
	<select id="findBadloansManagerInfo" resultMap="BadloansManager"
		parameterType="com.cardpay.pccredit.postLoan.filter.BloansManagerFilter">
		SELECT * FROM
		(SELECT ROW_.*,ROWNUM ROWNUM_
		FROM (
		SELECT
		b.id,b.CHINESE_NAME,sas.CUSTIDNO,sas.ACCOUNTSTATUS,sas.CONTRACTMONEY,sas.GRANTAMOUNT,sas.DUEDATE,
		sas.DEBTINTEREST,sas.RESTOREDAMOUNT,sas.DESCRIPTION,su.DISPLAY_NAME
		FROM T_SARM_SPECIALASSET sas
		left JOIN
		BASIC_CUSTOMER_INFORMATION b ON sas.OWNERCODE= b.TY_CUSTOMER_ID
		left JOIN
		SYS_USER su ON su.ID = b.USER_ID
		where 1=1
		<if test="id != null and id != '' ">
			AND su.id =#{id}
		</if>
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	<select id="findBadloansManagerInfoSize" resultType="int"
		parameterType="com.cardpay.pccredit.postLoan.filter.BloansManagerFilter">

		SELECT
		count(*)
		FROM T_SARM_SPECIALASSET sas
		left JOIN
		BASIC_CUSTOMER_INFORMATION b ON
		sas.OWNERCODE= b.TY_CUSTOMER_ID
		left JOIN
		SYS_USER su ON su.ID =
		b.USER_ID
		where 1=1
		<if test="id != null and id != '' ">
			AND su.id =#{id}
		</if>
	</select>
	<select id="findresultById" resultMap="BadloansResult">
	    SELECT b.id,b.deal_result,b.deal_date,s.DISPLAY_NAME as dealby FROM Badloans_dealresult b
		INNER JOIN SYS_USER s ON s.ID= b.create_by
		WHERE b.customer_id =#{id}
	</select>
	
		<select id="findrefusedMibusidata" resultMap="refusemibusidata" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
				  <!--  select tkmx.ywbh,basic.CHINESE_NAME,basic.CARD_ID,b.SJ as TELEPHONE,b.Cshy as industry,b.GTSPMC as spmc,b.YYDZ as RESIDENTIAL_ADDRESS,
                      yehz.JKJE,tkmx.JKRQ,pro.AUDIT_TIME,pro.REFUSAL_REASON,sysuser.DISPLAY_NAME, pro.PROCESS_OP_STATUS
                      from basic_customer_information basic,
                      ty_customer_base b,
                      ty_repay_tkmx tkmx,
                      ty_repay_yehz yehz,
                      customer_application_info app,
                      customer_application_process pro,
                      sys_user sysuser
                      where b.id=basic.ty_customer_id and
                            b.khnm=tkmx.khh and
                            tkmx.jjh=yehz.jjh and
                            app.customer_id=basic.id and 
                            app.id=pro.application_id and
                            sysuser.id=basic.user_id
                             and pro.PROCESS_OP_STATUS ='REJECTAPPROVE' -->
					    select app.ID as ywbh,basic.CHINESE_NAME as CHINESE_NAME,basic.CARD_ID as CARD_ID,''as TELEPHONE,'' as industry,'' as spmc,'' as RESIDENTIAL_ADDRESS,
  				app.APPLY_QUOTA as JKJE,app.created_time as JKRQ,
                     pro.AUDIT_TIME as AUDIT_TIME,pro.REFUSAL_REASON as REFUSAL_REASON,sysuser.DISPLAY_NAME DISPLAY_NAME, pro.PROCESS_OP_STATUS
                      from basic_customer_information basic,
                      customer_application_info app,
                      customer_application_process pro,
                      sys_user sysuser
                      where 
                            app.customer_id=basic.id and 
                            app.id=pro.application_id and
                            sysuser.id=basic.user_id
                             and pro.PROCESS_OP_STATUS ='REJECTAPPROVE'
					 <if test="busiCode != null and busiCode != '' ">
						AND trim(app.ID)=#{busiCode}
					 </if>
					 
					 <if test="customerName != null and customerName != '' ">
						AND basic.CHINESE_NAME =#{customerName}
					 </if>
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findrefusedMibusidatasize" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*) from (select app.ID as ywbh,basic.CHINESE_NAME as CHINESE_NAME,basic.CARD_ID as CARD_ID,''as TELEPHONE,'' as industry,'' as spmc,'' as RESIDENTIAL_ADDRESS,
  				app.APPLY_QUOTA as JKJE,app.created_time as JKRQ,
                     pro.AUDIT_TIME as AUDIT_TIME,pro.REFUSAL_REASON as REFUSAL_REASON,sysuser.DISPLAY_NAME DISPLAY_NAME, pro.PROCESS_OP_STATUS
                      from basic_customer_information basic,
                      customer_application_info app,
                      customer_application_process pro,
                      sys_user sysuser
                      where 
                            app.customer_id=basic.id and 
                            app.id=pro.application_id and
                            sysuser.id=basic.user_id
                             and pro.PROCESS_OP_STATUS ='REJECTAPPROVE'
					 <if test="busiCode != null and busiCode != '' ">
						AND trim(app.ID)=#{busiCode}
					 </if>
					 
					 <if test="customerName != null and customerName != '' ">
						AND basic.CHINESE_NAME =#{customerName}
					 </if>)
	</select>
	
	<!-- 信贷流程跟踪表 -->
	<select id="queryCreditProcess" resultMap="CreditProcess">
		  SELECT *from 
		  (SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  select 
					  distinct  cai.id,
            bai.spmc,
            bai.chinese_name,
            (select t.name from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)) as teamname,
             (SELECT  A.TYPE_NAME  FROM DICT A ,PRODUCT_ATTRIBUTE p 
             WHERE A .DICT_TYPE = 'CMMSCLNM-贷款担保方式' and A.TYPE_CODE=p.assure_means and p.id=cai.product_id) as assure_means,
             su.display_name,
            cai.created_time,
            cai.apply_quota,
            (case 
	        when cai.status ='audit'and tlog.examine_amount is null and sdh.sdtime is null then
	          '已申请'
	         when cai.status ='refuse' and cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) then
	          '被拒绝'
	         when cai.status ='returnedToFirst' and cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) then
	          '退回至客户经理'
	         when cai.status ='end' then
	          '放款成功'
	         when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
             and cai.status ='audit' and sdh.sdtime is null and cai.id not in (select capid from customer_sp) then
             '进件初审'
	         when cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) 
           	 and  cai.id in (select capid from customer_sp) then
             '审贷决议'
             when cai.id in (select capid from CUSTOMER_APPLICATION_SDH) then
             '审批结束' 
             else
	          ''  end) as status
              from customer_application_info cai  
				  	  left join customer_application_process aa on cai.id=aa.application_id
			          left join basic_customer_information bai on cai.customer_id=bai.id
		              left join sys_user su on su.id=bai.user_id
		              left join ty_customer_base base on bai.ty_customer_id=base.id
		              left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id
		              left join  wf_process_record pr on pr.id = aa.serial_number
		              left join wf_status_queue_record t on t.current_process = pr.id 
		              left join wf_status_info s on t.current_status = s.id 
		              left join T_APP_MANAGER_AUDIT_LOG tlog on tlog.application_id =cai.id
                  	  left join CUSTOMER_APPLICATION_SDH sdh on sdh.capid=cai.id
		              where 1=1
					<if test="customername!=null and customername!='' ">
						    and bai.chinese_name like  '%'||#{customername}||'%'
					</if>
					 order by cai.created_time desc
                   <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<!-- 统计行数 -->
	<select id="querySize" resultType="int" parameterType="com.cardpay.pccredit.postLoan.model.CreditProcess">
		  select count(distinct cai.id)
			  			from customer_application_info cai  
				  	  left join customer_application_process aa on cai.id=aa.application_id
			          left join basic_customer_information bai on cai.customer_id=bai.id
		              left join sys_user su on su.id=bai.user_id
		              left join ty_customer_base base on bai.ty_customer_id=base.id
		              left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id
		              left join  wf_process_record pr on pr.id = aa.serial_number
		              left join wf_status_queue_record t on t.current_process = pr.id 
		              left join wf_status_info s on t.current_status = s.id 
		              left join T_APP_MANAGER_AUDIT_LOG tlog on tlog.application_id =cai.id
                  	  left join CUSTOMER_APPLICATION_SDH sdh on sdh.capid=cai.id
		               where 1=1
			        <if test="customername!=null and customername!='' ">
						    and bai.chinese_name like  '%'||#{customername}||'%'
					</if>
	</select>
	
	<!-- 显示详情 -->
	<select id="queryAll" resultMap="CreditProcess" parameterType="String">
		     select  distinct cai.id,bai.spmc, bai.chinese_name,
             (select t.name from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)) as teamname,
             (select org.name from sys_organization org where id in(select t.org_id from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)))as bljg ,
             ''as dklx,
             (SELECT  A.TYPE_NAME  FROM DICT A ,PRODUCT_ATTRIBUTE p 
             WHERE A .DICT_TYPE = 'CMMSCLNM-贷款担保方式' and A.TYPE_CODE=p.assure_means and p.id=cai.product_id) as assure_means,
             '' as hyfl,
             su.display_name,
             cai.created_time,
             cai.apply_quota,
             (case
             when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
             t.start_examine_time
             when cai.status ='approved' or cai.status ='end' then
             sdh.sdtime
             when cai.status ='refuse' or cai.status ='returnedToFirst' then
             cai.modified_time
             end) as start_examine_time ,
           (case 
           when cai.status ='refuse' then
           '审核拒绝'
           when cai.status ='returnedToFirst' then
           '审核退回'
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
           '初审通过'
           when cai.status ='approved' or cai.status ='end' then
           '决议通过'
           else '' end) as examine_result，
           (case 
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
           tlog.examine_amount
           when cai.status ='approved' or cai.status ='end' then
           sdh.sdje
           else  '' end) as examine_amount,to_date(cai.jkrq,'yyyy-mm-dd') as jkrq,
             (case 
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
           tlog.examine_lv
           when cai.status ='approved' or cai.status ='end' then
           sdh.lv else '' end) as examine_lv,
             (case 
           when cai.status ='audit' and tlog.examine_amount is null and sdh.sdtime is null then
            '已申请'
           when cai.status ='refuse' and cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) then
            '被拒绝'
           when cai.status ='returnedToFirst' and cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) then
            '退回至客户经理'
           when cai.status ='end' then
            '放款成功'
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) and cai.status ='audit'
            and sdh.sdtime is null and cai.id not in (select capid from customer_sp) then
            '进件初审'
           when cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) 
           and  cai.id in (select capid from customer_sp) then
            '审贷决议'
           when cai.id in (select capid from CUSTOMER_APPLICATION_SDH) then
            '审批结束' 
            else
            ''  end) as status
             from customer_application_info cai  
                  left join customer_application_process aa on cai.id=aa.application_id
                  left join basic_customer_information bai on cai.customer_id=bai.id
                  left join sys_user su on su.id=bai.user_id
                  left join ty_customer_base base on bai.ty_customer_id=base.id
                  left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id
                  left join  wf_process_record pr on pr.id = aa.serial_number
                  left join wf_status_queue_record t on t.current_process = pr.id 
                  left join wf_status_info s on t.current_status = s.id 
                  left join T_APP_MANAGER_AUDIT_LOG tlog on tlog.application_id =cai.id
                  left join CUSTOMER_APPLICATION_SDH sdh on sdh.capid=cai.id
                  where 1=1 and cai.id=#{id}
              
	</select>
	
	<select id="findwfsr" resultMap="CreditProcess" parameterType="String">
   			select * from findwfsrs where 1=1 and id=#{id}
	    </select>
	    
	    <select id="findsplist" resultMap="CreditProcess" parameterType="String">
   			select * from findsplists where 1=1 and id=#{id}
	    </select>
	    
	     <select id="findcaslist" resultMap="CreditProcess" parameterType="String">
   			select * from findcaslist where 1=1 and id=#{id} and zsw='1'
	    </select>
	
	<!-- 导出-->
	<select id="creditProcessExportQueryAll" resultMap="CreditProcess" parameterType="com.cardpay.pccredit.postLoan.model.CreditProcess">
		       select  bai.spmc, bai.chinese_name,
             (select t.name from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)) as teamname,
             (select org.name from sys_organization org where id in(select t.org_id from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)))as bljg ,
             ''as dklx,
             (SELECT  A.TYPE_NAME  FROM DICT A ,PRODUCT_ATTRIBUTE p 
             WHERE A .DICT_TYPE = 'CMMSCLNM-贷款担保方式' and A.TYPE_CODE=p.assure_means and p.id=cai.product_id) as assure_means,
             '' as hyfl,
             su.display_name,
             cai.created_time,
             cai.apply_quota,
             (case
             when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
             t.start_examine_time
             when cai.status ='approved' or cai.status ='end' then
             sdh.sdtime
             when cai.status ='refuse' or cai.status ='returnedToFirst' then
             cai.modified_time
             end) as start_examine_time ,
           (case 
           when cai.status ='refuse' then
           '审核拒绝'
           when cai.status ='returnedToFirst' then
           '审核退回'
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
           '初审通过'
           when cai.status ='approved' or cai.status ='end' then
           '决议通过'
           else '' end) as examine_result，
           (case 
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
           tlog.examine_amount
           when cai.status ='approved' or cai.status ='end' then
           sdh.sdje
           else  '' end) as examine_amount,to_date(cai.jkrq,'yyyy-mm-dd') as jkrq,
             (case 
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
           tlog.examine_lv
           when cai.status ='approved' or cai.status ='end' then
           sdh.lv else '' end) as examine_lv,
             (case 
           when cai.status ='audit'and tlog.examine_amount is null and sdh.sdtime is null then
            '已申请'
           when cai.status ='refuse' and  cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) then
            '被拒绝'
           when cai.status ='returnedToFirst' and cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) then
            '退回至客户经理'
           when cai.status ='end' then
            '放款成功'
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) and cai.status ='audit'
           and sdh.sdtime is null and cai.id not in (select capid from customer_sp)then
            '进件初审'
           when cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) 
           and  cai.id in (select capid from customer_sp) then
            '审贷决议'
           when cai.id in (select capid from CUSTOMER_APPLICATION_SDH) then
            '审批结束' 
            else
            ''  end) as status, bai.CARD_ID
             from customer_application_info cai  
                  left join customer_application_process aa on cai.id=aa.application_id
                  left join basic_customer_information bai on cai.customer_id=bai.id
                  left join sys_user su on su.id=bai.user_id
                  left join ty_customer_base base on bai.ty_customer_id=base.id
                  left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id
                  left join  wf_process_record pr on pr.id = aa.serial_number
                  left join wf_status_queue_record t on t.current_process = pr.id 
                  left join wf_status_info s on t.current_status = s.id 
                  left join T_APP_MANAGER_AUDIT_LOG tlog on tlog.application_id =cai.id
                  left join CUSTOMER_APPLICATION_SDH sdh on sdh.capid=cai.id
	</select>
	
	<!-- 根据身份证号查询是否转贷 -->
	<select id="queryByCardId" resultMap="CreditProcess" parameterType="String">
		     select zjhm from  ty_customer_base base where base.zjhm=#{cardId} or base.posfzh=#{cardId}
	</select>
</mapper>
